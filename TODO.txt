use errno
mahmoud should remove unecessary malloc protections
